<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elterngespräch-Planer</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn {
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

            .btn-primary:hover {
                background: #5568d3;
                transform: translateY(-2px);
            }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

            .btn-secondary:hover {
                background: #667eea;
                color: white;
                transform: translateY(-2px);
            }

        .divider {
            margin: 30px 0;
            height: 1px;
            background: #e0e0e0;
        }

        .info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 30px;
            font-size: 14px;
            color: #0c5460;
        }

        .btn-child {
            background: #2ecc71;
            color: white;
            position: relative;
            padding-right: 50px;
        }

            .btn-child:hover {
                background: #27ae60;
                transform: translateY(-2px);
            }

        .btn-delete {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: background 0.3s;
        }

            .btn-delete:hover {
                background: rgba(192, 57, 43, 1);
            }

        #kinder-buttons {
            display: contents;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📅 Elterngespräch-Planer</h1>
        <p class="subtitle">Terminkoordination leicht gemacht</p>

        <div class="button-group">
            <a href="lehrer-login.html" class="btn btn-primary">
                👨‍🏫 Für Lehrpersonen<br>
                <small style="font-weight: normal; font-size: 14px;">Termine verwalten & zuteilen</small>
            </a>

            <!-- Dynamische Buttons für gespeicherte Kinder werden hier eingefügt -->
            <div id="kinder-buttons"></div>

            <a href="eltern-formular.html" class="btn btn-secondary" id="eltern-default-btn">
                👪 Für Eltern<br>
                <small style="font-weight: normal; font-size: 14px;">Verfügbarkeit angeben</small>
            </a>
        </div>

        <div class="info">
            <strong>Für Eltern:</strong> Klicken Sie auf "Für Eltern" und geben Sie Ihre verfügbaren Termine an.<br><br>
            <strong>Für Lehrpersonen:</strong> Melden Sie sich an, um Termine zu erstellen und zuzuteilen.
        </div>
    </div>

    <script>
        // Beim Laden: Gespeicherte Kinder-Links anzeigen
        window.onload = function() {
            loadSavedChildren();
        };

        function loadSavedChildren() {
            try {
                // Hole gespeicherte Kinder aus localStorage
                const kinder = JSON.parse(localStorage.getItem('elterngespraech_kinder') || '[]');

                if (kinder.length > 0) {
                    const container = document.getElementById('kinder-buttons');
                    const defaultBtn = document.getElementById('eltern-default-btn');

                    // Erstelle für jedes Kind einen Button
                    kinder.forEach((kind, index) => {
                        const link = document.createElement('a');
                        link.href = `eltern-formular.html?teacher=${kind.teacherId}`;
                        link.className = 'btn btn-child';
                        link.innerHTML = `
                            👶 ${kind.kindname}<br>
                            <small style="font-weight: normal; font-size: 14px;">Verfügbarkeit angeben</small>
                            <button class="btn-delete" onclick="event.preventDefault(); deleteChild(${index})">✕</button>
                        `;
                        container.appendChild(link);
                    });

                    // Ändere den Standard-Button zu "Weiteres Kind hinzufügen"
                    defaultBtn.innerHTML = `
                        ➕ Weiteres Kind hinzufügen<br>
                        <small style="font-weight: normal; font-size: 14px;">Neue Verfügbarkeit angeben</small>
                    `;
                }
            } catch (error) {
                console.error('Fehler beim Laden der gespeicherten Kinder:', error);
            }
        }

        function deleteChild(index) {
            if (confirm('Möchten Sie diesen Link wirklich entfernen?')) {
                try {
                    // Hole aktuelle Liste
                    let kinder = JSON.parse(localStorage.getItem('elterngespraech_kinder') || '[]');

                    // Entferne das Kind an der gegebenen Position
                    kinder.splice(index, 1);

                    // Speichere zurück
                    localStorage.setItem('elterngespraech_kinder', JSON.stringify(kinder));

                    // Seite neu laden um Änderungen anzuzeigen
                    location.reload();
                } catch (error) {
                    console.error('Fehler beim Löschen:', error);
                    alert('Fehler beim Entfernen des Links.');
                }
            }
        }
    </script>
</body>
</html>